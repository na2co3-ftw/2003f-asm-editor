# 2003f Editor 詳細仕様

## 2003fインタプリタ
参照元: [Haskell Interpreter版](https://github.com/jurliyuuri/OS/tree/master/assembler)

### 追加した実行時警告
* アラインメントされていないメモリアクセス
* 64以上のビットシフト

## 2003lk
参照元: [Haskell Interpreter版](https://github.com/jurliyuuri/OS/tree/master/assembler)

### 仕様変更
* U+2028, U+2029, U+FEFF も空白文字として扱う (Haskellの `isSpace` と JSの `/\s/` の差)
* `lifem` `lifem8` `lifem16` を試験実装

### 追加した警告
* `fi` の直後に `malkrz` がない時
* `malkrz` が `fi` の直後にない時
* `malkrz` にラベルを付けた時
* 命令よりも先に、 `'c'i` または `'i'c` のどちらかが明示的に指定されていない時
* `l'` 、 `nll` または `xok` によるラベル定義で、ラベル名がキーワード名(`kak` 含)と重複する時
* `l'` の直前が命令ではない(`'c'i` 等の)時
* `nll` の直後が命令ではない時
* 定義されたラベルが、一度も使用されていない時
* `inj f0 f1 f1@` や同様の `lat` `latsna` での未定義動作を書いた時
* (未実装) `kue` されたラベルが、他ファイルで一度も使用されていない時

## tinka_new
参照元: [C#版](https://github.com/Nobuyuki-Tokuchi/tinka)

### 動作の差異
* U+FEFF も空白文字として扱う。 U+0085 は空白文字として扱わない (C#の `Char.IsWhiteSpace` と JSの `/\s/` の差)
* ファイル終端での行コメントを認める
* 2^31以上の数を記述可能に (2^32の剰余として扱う)
* `kue` を実装。それに伴い変数名、関数名として `kue` が使用不可に
* `ada` `ekc` `dal` 演算子を実装
* `sna 1 sna 2` のような式を禁止
* `sna sna 1` のような式を許容 
* `#p:1` のような式で、変数配列の各要素の値を取得できるように
* `p():1` のような式を禁止
* `#p:sna #F` のような式を許容
* `anax p el` のような文を禁止
* `1 eksa #p:1` のような文を許容
* `el` や `eksa` での代入先として `#p:#F:1` のような多重の配列参照ができるように
* `dosnud` で返り値を省略できるように
* 式単体でも文を作れるように
* 定められた構文以外の記述を禁止 (本家では無視)
* `fasal` のないプログラムに対応。その場合は、グローバル変数が初期値を持つことを禁止
* グローバル変数の名前に `[FRVXa-z0-9'_-]` 以外の文字を含むことを禁止 
* ローカル変数の初期値の評価と初期化は、その `anax` 文の位置で行われる
* サイズが0の配列の配列を禁止

### 追加した警告
* 宣言された関数または `xok` で指定したラベルが、一度も使用されていない時
* `fasal` 関数が引数を持つ時

## tinka
参照元: [Kotlin版](https://github.com/Nobuyuki-Tokuchi/old_tinka)

### 仕様変更
* U+FEFF も空白文字として扱う。 U+001C-U+001F は空白文字として扱わない (Kotlinの `Char.isWhitespace` と JSの `/\s/` の差)
* 配列の要素数、添字として2^63以上の数を記述可能に (2^32の剰余として扱う)

### 追加した警告
* 変数宣言で、変数名が数字の時: `anax 1`
* 変数宣言で、変数名が `kue` 、 `xok` または `fi` の時: `anax fi`
* 変数宣言で、変数名が `/[FRVXa-z0-9'_-]+/` に一致しない時: `anax あ`
* 変数宣言で、配列のサイズが `+` か `-` で始まる時: `anax p@+10`
* 変数宣言で、@が2つ以上含まれる時: `anax p@10@2` (`p@10` として解釈される)
* 変数宣言が、関数の中で先頭ではない時
* 変数名が重複している時: `anax p anax p`
* 配列として宣言された変数を通常の変数として使用した時
* 通常の変数として宣言されたものを配列として使用した時
* `xok` で指定したラベル名が数字で始まる時、キーワードと重複する時、または `/^(fi|fal(-rinyv)?|dosnud)\d+$/` に一致する時: `xok krz`
* 関数名が、キーワードと重複する時、または `/^(fi|fal(-rinyv)?|dosnud)\d+$/` に一致する時: `cersva krz`
* 関数の引数名がキーワードと重複する時: `cersva p krz`
* `_fasal` 関数が引数を持つ時: `cersva _fasal p`
* 関数の引数名が重複している時: `cersva p F F`
* 関数呼出や `xok` で内部ラベル(`dosnud1` など)を使用した時
* 関数呼出で与える引数の数が関数宣言と一致しない時
* ファイル終端の直前にトークンがある時 (本家ではトークンの後に空白またはコメントを挟まずにファイル終端があると、その命令が無視される)
* (未実装) 値を返さない関数の返り値を使用しようとした時

重要度の低いもの
* 宣言された変数または引数が、一度も使用されていない時
* 宣言された関数または `xok` で指定したラベルが、一度も使用されていない時
* `rinyv` 〜 `situv` の間に何もない時: `rinyv situv`
* (未実装) `kue` されたラベルが、他ファイルで一度も使用されていない時

### 追加したエラー
* 変数宣言で、配列のサイズが数字ではない時: `anax p@F` (本家ではjava.lang.NumberFormatExceptionになる)
* 宣言されていない変数を使用した時 (本家ではkotlin.KotlinNullPointerExceptionになる)
* 関数宣言または `xok` で指定されたラベルが、内部ラベルと重複した時 (本家では2003lkパーサがラベル重複定義エラーを吐く)

## cent
参照元: [C#版](https://github.com/Nobuyuki-Tokuchi/Cent) (developブランチ)

### 仕様変更
* U+FEFF も空白文字として扱う。 U+0085 は空白文字として扱わない (C#の `Char.IsWhiteSpace` と JSの `/\s/` の差)
* 2^31以上の数を記述可能に (2^32の剰余として扱う)
* `+1` などの `+` のついた数字を禁止
* サブルーチンの最初に `fen` を挿入する (ステップ実行のため)
* サブルーチン名として `.` を許可、 `tikl` を禁止

### 追加した警告
* サブルーチン名が `/[^FRVXa-z0-9,.?!':+|=$\\@&#"()《》_-]/` を含む時
* `xok` で指定された関数名が `/^(fal|laf|ol|if|cecio|oicec|leles-niv|leles-situv)\d+$/` に一致する時
* `fi` 〜 `if` 、 `cecio` 〜 `oicec` 、 `fal` 〜 `laf` 内でサブルーチンまたは `xok` を宣言した時
* サブルーチン名と `xok` で指定された関数名が重複した時
* 重複した名前のサブルーチンを定義し、それが1度も呼ばれていない時
* ファイル終端の直前にトークン(`<` `>` を除く)がある時 (本家ではトークンの後に空白、コメント、 `<` `>` のいずれも挟まずにファイル終端があると、その命令が無視される)

重要度の低いもの
* サブルーチンの中が空の時: `<p>`
* `fi` 〜 `if` または `ol` 、 `ol` 〜 `if` 、 `cecio` 〜 `oicec` 、 `fal` 〜 `laf` の間に何もない時
* 定義されたサブルーチンまたは `xok` で指定した関数が、一度も使用されていない時

### 追加したエラー
* `xok` で指定されたラベルが、内部ラベルと重複した時 (本家では2003lkパーサがラベル重複定義エラーを吐く)

## ata2003lk
参照元: [Lua版](https://github.com/Nobuyuki-Tokuchi/ata2003lk)

### 仕様変更
* U+0012, U+0013, U+00A0, U+1680, U+2000-U+200A, U+2028, U+2029, U+202F, U+205F, U+3000, U+FEFF も空白文字として扱う。 (JSの `/\s/`)
* `+1` などの `+` のついた数字を禁止
* `0x1` などの16進数の数字を禁止
* 2^63以上の数を記述可能に (2^32の剰余として扱う)
* `tvarlon-knloan@` を禁止
* 定数名をラベルとして扱う (ラベルに使えない文字を禁止、ラベルとの重複を禁止)
* `zali` のオペランドとして定数を使用可能に

### 追加した警告
* `fi` の直後に `malkrz` または `maldus` がない時
* `malkrz` または `maldus` が `fi` の直後にない時
* `malkrz` または `maldus` にラベルを付けた時
* `l'` 、 `nll` 、 `xok` 、 `snoj` によるラベル定義で、ラベル名がキーワード名(`kak` `xx` 含、 `'i'c` 、 `'c'i` 含まない)と重複する時
* `xok` または `kue` に指定するラベルで、ラベル名が `/^--(lar--(sit--)?)\d+$/` を含む時
* `l'` の直前が命令ではない(`xok` 等の)時
* `nll` の直後が命令ではない時
* 定義されたラベルが、一度も使用されていない時
* `inj f0 f1 f1@` や同様の `lat` `latsna` での未定義動作を書いた時
* 不明なプリプロセッサ命令 (`!p` など)
* (未実装) `cers` で `lifem` `lifem8` `lifem16` にラベルを付けた時
* (未実装) `kue` されたラベルが、他ファイルで一度も使用されていない時

### 追加したエラー
* `xok` で指定されたラベルが、内部ラベルと重複した時 (本家では2003lkパーサがラベル重複定義エラーを吐く)
